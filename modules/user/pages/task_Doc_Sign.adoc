= Произвольное подписание

[[task_wfq_vdx_tj__context_rhc_xxw_1jb]]
Чтобы подписать карточку _Документ_ ЭП, выполните следующие действия:

[[task_wfq_vdx_tj__steps_shc_xxw_1jb]]
. [.ph .cmd]#Откройте карточку _Документ_, которую требуется подписать.
. [.ph .cmd]#На ленте карточки нажмите на кнопку:#
* image:buttons/signDoc.png[image] -- чтобы выполнить подписание;
* [.ph .uicontrol]*Подписать* -- чтобы дополнительно настроить подписание.
+
Чтобы дополнительно настроить подписание:
[loweralpha]
.. [.ph .cmd]#Нажмите на кнопку [.ph .uicontrol]*Подписать*.
+
image::Dcard_sign_button_menu.png[[.fig--title-label]#Рис. 1. # Меню кнопки "Подписать"]
.. [.ph .cmd]#Выберите команду [.ph .uicontrol]*Варианты*. Будет открыто окно [.keyword .wintitle]*Варианты подписи*.
.. [.ph .cmd]#В раскрывающемся списке [.ph .uicontrol]*Метка* выберите метку из числа доступных для вида. Настройка меток производится в _Справочника меток подписей_.
.. [.ph .cmd]#В раскрывающемся списке [.ph .uicontrol]*За кого* выберите сотрудника, от имени которого будет подписана карточка. Данное поле активно, если в _Справочнике сотрудников_ текущий пользователь указан хотя бы для одного сотрудника заместителем с правом подписи.
.. [.ph .cmd]#После выбора сотрудника ([.ph .uicontrol]*За кого*) становится активным дополнительное поле [.kbd .ph .userinput]`Текст подтверждения ЭЦП`. По умолчанию в поле подставляется доступное для изменения значение настройки [.keyword .parmname]_Текст подтверждения ЭЦП_, заданное в карточке сотрудника для соответствующего замещаемого.
+
image::Dcard_sign_options.png[[.fig--title-label]##Рис. 2. ##Настройка варианта подписи]
. [.ph .cmd]#Выберите сертификат подписи и нажмите на кнопку [.ph .uicontrol]*OK*, или нажмите на кнопку [.ph .uicontrol]*Простая подпись*.
+
image::Cert_select.png[[.fig--title-label]##Рис. 3. ##Выбор сертификата ЭЦП при подписании]
+
Окно выбора сертификата не отображается, если:

* У пользователя один сертификат и он указан в _Справочнике сотрудников_ (будет использован этот сертификат).
* У пользователя нет сертификатов для подписания (будет использована простая подпись).
* В _Справочнике сотрудников_ установлен параметр [.ph .uicontrol]*Не показывать окно выбора сертификата*. В этом случае вместо окна выбора сертификата будет выдано сообщение: `Будет выполнено подписание с помощью                                     сертификата`. После подтверждения операции подписания будет наложена усиленная электронная подпись с использованием указанного сертификата. Если сертификат, указанный в _Справочнике сотрудников_, просрочен, или не удалось проверить его состояние, будет выдано сообщение: `Не                                     удалось выполнить подписание с использованием сертификата.                                     Сертификат недействителен или же его состояние не может быть                                     проверено. Обратитесь к администратору системы` и подпись наложена не будет.
+
При подписании с помощью сертификата в зависимости от настроек системы {dv} и наличия на компьютере требуемого ПО формируется простая или усиленная подпись.

При подписании _основных_ файлов, приложенных к карточке, формируется одна подпись, в которую включается по отдельной части для каждого из основных файлов. Номер версии каждого основного файла отображается в его части подписи.

[IMPORTANT]
====
Со стандартными настройками в {dv} не поддерживается подписание сертификатом файлов с размером больше 35 МБ. При попытке подписать файл большего размера возникнет ошибка. Допустимый размер для подписываемых файлов может быть изменён администратором.
====

[[task_wfq_vdx_tj__postreq_yhc_xxw_1jb]]
Если это предусмотрено настройками вида карточек, функция подписания вызывается автоматически при выполнении определенной операции с документом, при этом электронная подпись формируется в соответствии с настройками подписания, заданными для вида карточек в _Справочника видов карточек_. При выполнении автоматического подписания будет выведен диалог выбора сертификата в соответствии с условиями, приведенными в п. 3.

