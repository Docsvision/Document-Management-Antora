= Шифрование файлов

Возможность шифрования файлов реализована для базового типа карточки _Документ_ и настроена во всех видах карточек _Документ УД_ (кроме вида _Рабочий_) для пользователя с ролью _Регистратор_ и в состояниях `Подготовка`, `Зарегистрирован`, `В работе`, `В архиве`.

Шифрование в карточках становится доступным только после настройки администратором {dv} параметров шифрования в справочнике _Системные настройки_. В _Конструкторе ролей_ для шифрования используется операция _Шифрование файлов_.

Шифрование в карточках становится доступным только для тех пользователей, у которых в _Справочнике сотрудников_ указан сертификат.

Для зашифрованных файлов запрещена отправка на согласование, однако разрешено создание заданий и групп заданий. На вкладке _Ссылки_ для режима _Файлы_ запрещен просмотр зашифрованных файлов для сотрудников, у которых не настроен доступ к зашифрованным файлам.

.Чтобы зашифровать файлы карточки:
. Откройте карточку вида _Документ УД_.
. На ленте карточки нажмите на кнопку image:buttons/lock-key.png[Замок с ключом] *Шифрование файлов*.
+
Если шифрование выполняется для _Дополнительных_ файлов, в списке рядом с их названием появится пометка о том, что файл является дополнительным.
+
Будет открыто окно _Шифрование файлов_.
+
.Шифрование файлов карточки
image::encoding.png[Шифрование файлов карточки]
+
. В области _Список файлов_ выберите файл, для которого требуется настроить шифрование.
+
Шифрование выполняется сразу для всех файлов, однако список сотрудников, которые будут иметь доступ к зашифрованному файлу, необходимо сформировать отдельно для каждого из файлов.
+
. Укажите сотрудников, которые могут иметь доступ к зашифрованному файлу.
+
.Чтобы добавить сотрудника в список:
* Нажмите на кнопку image:admin:buttons/plus-geen.png[Зелёный плюс] и выберите запись из _Справочника сотрудников_.
* Введите первые буквы имени сотрудника в строку быстрого поиска, затем дважды щелкните левой клавишей мыши на найденной записи.
+
Допускается выбор только тех сотрудников, у которых в _Справочнике сотрудников_ указан сертификат подписи. Если сертификат отсутствует, при подтверждении выбора будет выдано предупреждение: `Не удалось добавить сотрудника. У пользователя <ФИО> отсутствует сертификат. Обратитесь к администратору системы`.
+
. Нажмите на кнопку *Зашифровать*.
+
При этом возможно появление окна для выбора сертификата подписи.
+
. Укажите тип подписи, затем нажмите на кнопку *ОК*.
+
Если сертификат действителен, выполняется шифрование основных и/или дополнительных файлов в соответствии с настройками провайдера, алгоритма и ключа из справочника _Системные настройки_. Сертификаты пользователей, указанных в списке, берутся из настроек _Справочника сотрудников_. Для каждого из указанных пользователей формируется ключ.
+
****
В карточке название зашифрованного файла изменит цвет на зеленый, а в иконке файла появится значок, указывающий, что файл зашифрован.

Зашифрованный файл будет отображаться в списке файлов документа для всех пользователей, имеющих доступ к данной карточке, однако прочитать такой файл могут только пользователи, у которых настроен доступ к зашифрованному файлу. Если доступа нет, будет выдано сообщение: `Файл зашифрован. Не удалось выполнить операцию в связи с ограничением прав доступа`. При открытии на чтение зашифрованного файла будет выполнена автоматическая дешифровка файла и выгрузка его во временную папку.

У пользователя, который выполнил шифрование файлов, на ленте карточки станет доступным выпадающее меню кнопки *Шифрование файлов*, содержащее команды для управления зашифрованными файлами.

.Меню управления зашифрованными файлами
image::encoding-menu.png[Меню управления зашифрованными файлами]
****
+
. Если в карточку был добавлен новый файл (основной и/или дополнительный), для его шифрования выберите в меню кнопки команду *Зашифровать файлы*.
+
Если для дополнительных файлов шифрование в справочнике _Системные настройки_ не настроено, при добавлении к карточке дополнительного файла команда для шифрования файлов останется недоступной.
+
После расшифровывания становится возможным его редактирование.
+
. Чтобы расшифровать файлы, выберите в меню кнопки команду *Расшифровать файлы*.
+
Файлы будут расшифрованы и станут доступны всем пользователям.
+
. Чтобы отредактировать список сотрудников, для которых было выполнено шифрование, выберите в меню кнопки команду *Редактировать список сотрудников*, в открывшемся окне _Шифрование файлов_ отредактируйте список и затем нажмите на кнопку *Зашифровать*.
+
Аналогичные действия будут выполнены при нажатии на кнопку *Шифрование файлов*.
+
При изменении состава сотрудников будет выполнено повторное шифрование файлов с учетом изменений. При этом, возможно, будет запрошен сертификат подписи.
