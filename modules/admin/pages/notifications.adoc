= Настройка уведомлений

В приложении _{dm}_ предусмотрена возможность отправки ряда уведомлений по электронной почте. Отправка сообщений осуществляется бизнес-процессами (список БП приведен в пункте xref:ROOT:business-processes.adoc[Бизнес-процессы]).

[NOTE]
====
Механизма обновления бизнес-процесса отправки уведомлений не предусмотрено. При необходимости модификации рекомендуется разработать собственный бизнес-процесс на основе поставляемого.
====

.В приложении могут быть настроены следующие уведомления:
* xref:notifications/acceptance-start.adoc[Уведомление о начале приёмки задания].
* xref:notifications/rejected-author.adoc[Уведомление Автора об отклонении задания].
* xref:notifications/completion-author.adoc[Уведомление Автора о завершении задания].
* xref:notifications/completion-group-author.adoc[Уведомление Автора о завершении группы заданий].

[#xslt]
include::5.5.5@backoffice:desdirs:partial$excerpts.adoc[tags=xslt]

.Отправка уведомлений доступна после выполнения ряда настроек:
. В разделе _{wf}_ программы _{cns}_ должны быть настроены параметры отправки электронной почты (см. раздел "Настройка почты" в руководстве администратора модуля {wf}).
. БП "ПК Мониторинг почты" должен быть запущен (см. раздел "Запуск БП "ПК Мониторинг почты" в руководстве администратора модуля {wf}).
. В _Справочнике сотрудников_ у сотрудника должен быть указан _E-mail_ (адрес электронной почты, на который будут отправляться уведомления).
. Должны быть настроены форматы ссылок для открытия заданий в {wincl}е и, если требуется, {wc}е. Подробнее см. раздел xref:5.5.5@backoffice:desdirs:staff/employees/main-tab.adoc#routing["Настройка общих параметров маршрутизации"] в документации модуля {bo}.
. Должны быть заполнены _E-mail адрес администратора_ и _E-mail адрес сервера_ xref:5.5.5@backoffice:admin:routing-general.adoc#admin-mail[в справочнике системных настроек].
. В модуле _{mc}_ на вкладке _Соединения_ должны быть заполнены xref:5.5.1@mgmtconsole:user:connections-mail-server.adoc[настройки соединения Почтового сервера].
. Настроенное соединение должно быть выбрано в _Консоли управления {dv}_, на вкладке _Служба {ws}_ в раскрывающемся списке _Соединение Почтовый сервер_.

[#template]
== Настройка шаблона уведомлений

Администратор может настроить требуемым образом шаблон для оповещений, отправляемых по электронной почте.

Шаблон настраивается с помощью XSLT преобразования. Исходный текст стандартного преобразования доступен по ссылке, приведенной в xref:appendix/xslt-mail-notification.adoc[Приложении B].

.Чтобы настроить собственный шаблон уведомления:
. Откройте _Справочник видов карточек_.
. Выберите тип карточек *_Задание_* и вид задания, настройки которого нужно изменить.
. Перейдите на вкладку _Настройки почтовых уведомлений_.
+
.Вкладка "Настройки почтовых уведомлений"
image::main-notifications-settings.png[Вкладка "Настройки почтовых уведомлений"]
+
. Задайте собственный шаблон почтовых уведомлений: установите флаг `*Дополнительные почтовые уведомления*`.
+
[WARNING]
====
Начиная с версии 5.5.4 Приложения {dm} изменился способ рассылки уведомлений.

Стандартные БП рассылки уведомлений больше не используются и будут автоматически отключены при установке обновления.

Если собственные уведомления с использованием БП были настроены и привязаны в справочнике видов, они продолжат работать без изменений.
====
+
****
Флаг должен быть установлен, если для добавленных видов требуется использовать стандартные дополнительные уведомления.

[lowerroman]
. Чтобы отключить или заменить новые уведомления, нужно для определенного вида задания отключить сервисы рассылки уведомлений. Это можно сделать при помощи программы _DVExplorer_: поставить флаг `UseOwnServices` и задать свои сервисы, нажав кнопку image:buttons/three-dots.png[Три точки] в поле _Дополнительные почтовые уведомления_. Либо не задавать сервисы совсем, тогда уведомления рассылаться не будут.
. Чтобы отключить только дополнительные уведомления УД, достаточно снять флаг `*Дополнительные почтовые уведомления*` в справочнике видов.
****
+
. В открывшемся окне редактора измените XSLT код и нажмите кнопку *ОК*.
+
Если код XSLT-преобразования отсутствует, будет использован стандартный шаблон.
+
. Установите флаг `*Отображать связанный документ в письме*`, чтобы в оповещения добавлялись атрибуты связанного с заданием документа.
+
Настройка шаблона для блока с информацией о документе, рассмотрена в документации по администрированию модуля {bo}: xref:5.5.5@backoffice:admin:routing-attributes.adoc["Настройка отображения атрибутов документа в письме с заданием"].
. Сохраните изменения в Справочнике видов карточек.
