= Обновление приложения

include::webclient:ROOT:partial$excerpts.adoc[tags=what-changed]

[#conditions]
== Условия обновления

[WARNING]
====
При обновлении модуля будут перезаписаны настройки стандартных папок, поисковых запросов и представлений Приложения.
====

* Настройки созданных пользователем объектов не затрагиваются.
+
Если в настройки стандартных элементов Приложения были внесены изменения, которые нужно сохранить, экспортируйте их перед обновлением и импортируйте после обновления.
+
* Установка новой версии должна выполняться в нерабочее время. Потребуется остановка работы {dv} и обновление БД.
* При обновлении версия клиентского дистрибутива должна быть равной версии серверного дистрибутива.
* Если к новой версии приложения приложена инструкция по обновлению, следуйте ей.
* Если комплект обновления включает обновление для модуля {pl}, перейдите к инструкции, приведенной в xref:6.1@platform:admin:update-module.adoc[документации модуля {pl}].

[#update]
== Порядок обновления

.Чтобы установить новую версию приложения:
. Создайте резервную копию БД.
include::ROOT::partial$stop.adoc[]
. Установите новую версию приложения на сервере {dv} из пакета установки `{dv} DocumentManagement server.msi`, не удаляя существующей версии.
+
[NOTE]
====
При обновлении используется каталог и область установки текущей версии.
====
+
include::ROOT::partial$go.adoc[]
+
.Мастер установки приложения
image::update-db-flag.png[Мастер установки приложения]
+
. Выберите базы данных, в которых будут обновлены библиотеки карточек приложения, и нажмите *Ок*.
+
.Список баз данных для обновления
image::update-db-list.png[Список баз данных для обновления]
+
Будет запущен процесс обновления БД.
+
.При завершении обновления:
* Будет показано окно с результатом обновления.
* Сервисы {dv} будут перезапущены.
+
. Запустите программу _{cns}_ и завершите настройку {dv} xref:6.1@platform:admin:config-master.adoc[стандартным образом].
+
Пользователь, от имени которого запускается _{cns}_ должен являться администратором {dv}, а также входить в группы {dv} в Справочнике сотрудников: _{dv-dm-admins-dir}_, _{dv-ad-admins-dir}_ и _Системная для WF_.
+
При выполнении данной операции в БД {dv} будут загружены стандартные настройки приложения {dm}.
+
. Установите новую версию приложения, не запуская обновление БД (флаг `*Обновить базу данных*` должен быть снят):
+
* На оставшихся узлах кластера {dv}.
* На сервере СУБП, {wc}а и других модулей, использующих компоненты приложения {dm}.
+
. Клиентская часть приложения обновится автоматически при открытии {wincl}а.

[#update-multiple]
== Обновление нескольких модулей

Если планируется обновлять несколько модулей, следующие действия следует выполнять один раз после установки новых версий всех модулей.

[WARNING]
====
Следующие действия приведут к загрузке стандартных настроек приложения _{dm}_ и модуля _{ad}_. Чтобы сохранить собственные изменения, обновите БД по инструкции <<update-no-overwrite,Обновление базы данных {dv} без перезаписи стандартных настроек>>, после чего перейдите к шагу 4.
====

. Откройте _{cns}_. Программа будет запущена в режиме мастера настройки.
+
Пользователь, от имени которого запускается _{cns}_ должен являться администратором {dv}, а также входить в группы {dv} в Справочнике сотрудников: _{dv-dm-admins-dir}_, _{dv-ad-admins-dir}_ и _Системная для WF_.
+
. На странице _Базы данных_ выберите рабочую БД {dv}, установите переключатель в режим *Использовать выбранную в списке базу данных* и нажмите *Далее*.
+
.Обновление базы данных
image::common:update-db.png[Обновление базы данных]
+
. Будет предложено обновить базу данных до новой версии. Выберите вариант *ДА*.
. На следующей странице не изменяйте выбор обновляемых библиотек карточек. Нажмите *Далее*.
+
.Обновление библиотеки карточек
image::common:update-card-lib.png[Обновление библиотеки карточек]
+
. На странице _Параметры базы данных_ нажмите *Далее*. Появится запрос на подтверждение обновления -- согласитесь. Процесс обновления займет некоторое время.
. На странице настройки производительности и перезапуска IIS нажмите *Далее*.
+
include::6.1@platform:console:db-update.adoc[tags=special]
+
. Подтвердите настройки Workflow и выйдите из мастера.
. Обновите версию приложения на всех узлах кластера {dv}, СУБП и {wc}а.
. Клиентские компоненты приложения на компьютерах пользователей будут обновлены автоматически при запуске {wincl}а.
+
Самостоятельно обновить клиентские компоненты можно из пакета установки `{dv} DocumentManagement client.msi`.

[#update-no-overwrite]
== Обновление базы данных {dv} без перезаписи стандартных настроек

. Измените в редакторе реестра Windows значение параметра `{hklm-dv}\Platform\5.5\Console\WizardMode` на `0`.
. Откройте _{cns}_.
+
Пользователь, от имени которого запускается _{cns}_ должен являться администратором {dv}, а также входить в группы {dv} в Справочнике сотрудников: _{dv-dm-admins-dir}_, _{dv-ad-admins-dir}_ и _Системная для WF_.
+
. Перейдите в раздел настроек menu:Настройки сервера[Базы данных].
. Нажмите кнопку *Мастер баз данных*. Будет открыто окно _Мастер БД {dv}_.
. Выберите обновляемую БД. Переключите режим в значение *Обновить выбранную в списке базу данных*.
. Выполните обновление стандартным образом (см. xref:6.1@platform:console:db-update.adoc[документацию модуля {pl}]). На шаге выбора загружаемых модулей, откажитесь от загрузки модулей, настройки которых требуется сохранить.
+
. На шаге применения специальной конфигурации {dm}, нажмите кнопку *Пропустить*, чтобы сохранить стандартные настройки модуля.
